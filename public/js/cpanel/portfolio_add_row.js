$(document).ready(function(){function t(t){if(t.files&&t.files[0]){var a=new FileReader;a.onload=function(a){var e=$(t).attr("data-preview");$("#img"+e).attr("src",a.target.result)},a.readAsDataURL(t.files[0])}}$(".page-name").find("span").html("Portfolio: ADD ROW");var a=$("#addNewRow"),e=$("#editModalText"),o=$("#editModalImage"),n=$("#editModalVideo"),i=function(t){return $("<div class='el-control-actions'><span class='fa fa-remove el-remove pull-right' title='Remove'></span><span class='fa fa-edit el-edit pull-right "+t+"' title='Edit'></span><span class='fa fa-arrows-alt el-move pull-right' title='Sort'></span></div>")},l=function(){return"_id_"+Math.floor(9954151998462e4*Math.random())},r=function(){$(".sortable-row").sortable({connectWith:".sortable-row",handle:"span.el-move"}).disableSelection(),$("#saveRowJson").show()},d=function(){$("#addElement").modal("hide"),r()};$(".element-text").on("click",function(){var t=$("<div class='col-xs-12 el-create-sort' data-layout='12' data-asterisk='true' data-bold='header' data-alignment='left' data-family='default' data-node='text' id='"+l()+"'></div>"),e=$("<div class='row-1 data-rows-count'><input name='eng' placeholder='eng' class='form-control width-6 el-header' type='text'><input name='rus' placeholder='rus' class='form-control width-6 el-header' type='text'><textarea rows='4' name='eng' placeholder='eng' class='form-control width-6'></textarea><textarea rows='4' name='rus' placeholder='rus' class='form-control width-6'></textarea></div>"),o=i("text-edit-mod");o.appendTo(t),e.appendTo(t),t.appendTo(a),d()});var s=function(t,a,o,n,i,l){e.attr("data-toggle-col",a),e.find(t).click(),"false"==o?e.find("#asteriskStatus").removeAttr("checked"):e.find("#asteriskStatus").prop("checked",!0),e.find("input[name='text-bold']").each(function(){$(this).val()==n&&$(this).click()}),e.find("input[name='text-alignment']").each(function(){$(this).val()==i&&$(this).click()}),e.find("input[name='text-font-family']").each(function(){$(this).val()==l&&$(this).click()}),e.modal("show")};$(document).on("click","span.text-edit-mod",function(t){t.preventDefault();var a=$(this),e=a.parents("div.el-create-sort"),o="#layout1",n=e.attr("data-layout");"6"==n&&(o="#layout2");var i=e.attr("id"),l="true";"false"===e.attr("data-asterisk")&&(l="false");var r="header";"all"===e.attr("data-bold")&&(r="all"),"none"===e.attr("data-bold")&&(r="none");var d="left";"center"===e.attr("data-alignment")&&(d="center"),"right"===e.attr("data-alignment")&&(d="right");var c="default";"default"!==e.attr("data-family")&&(c="custom"),s(o,i,l,r,d,c)}),$(document).on("click","label.layout-btn",function(t){t.preventDefault();var a=$(this),e=a.parents("div.modal").attr("data-toggle-col"),o=a.find("input").attr("data-class-name"),n=$("#"+e);n.attr("class",""),n.addClass(o+" col-xs-12 el-create-sort"),n.attr("data-layout",a.find("input").attr("value"))}),$(document).on("click","input#asteriskStatus",function(){var t=$(this),a=t.parents("div.modal").attr("data-toggle-col"),e=t.prop("checked"),o=$("#"+a);o.attr("data-asterisk",e)}),$(document).on("click","button#addtextRow",function(){var t=$(this),a=t.parents("div.modal").attr("data-toggle-col"),e=$("#"+a),o=e.find(".data-rows-count").length;if(3>o){var n=$("<div class='row-"+parseInt(o+1)+" data-rows-count'><input name='eng' placeholder='eng' class='form-control width-6 el-header' type='text'><input name='rus' placeholder='rus' class='form-control width-6 el-header' type='text'><textarea rows='4' name='eng' placeholder='eng' class='form-control width-6'></textarea><textarea rows='4' name='rus' placeholder='rus' class='form-control width-6'></textarea></div>");n.appendTo(e)}else t.attr("disabled")}),$(document).on("click","input[name='text-bold']",function(){var t=$(this),a=t.parents("div.modal").attr("data-toggle-col"),e=t.val(),o=$("#"+a);o.attr("data-bold",e),"header"==e&&(o.find("input.form-control").css({"font-weight":600}),o.find("textarea.form-control").css({"font-weight":100})),"all"==e&&(o.find("input.form-control").css({"font-weight":600}),o.find("textarea.form-control").css({"font-weight":600})),"none"==e&&(o.find("input.form-control").css({"font-weight":100}),o.find("textarea.form-control").css({"font-weight":100}))}),$(document).on("click","input[name='text-alignment']",function(){var t=$(this),a=t.parents("div.modal").attr("data-toggle-col"),e=t.val(),o=$("#"+a);o.attr("data-alignment",e),"left"==e&&o.find(".form-control").css({"text-align":"left"}),"center"==e&&o.find(".form-control").css({"text-align":"center"}),"right"==e&&o.find(".form-control").css({"text-align":"right"})}),$(document).on("click","input[name='text-font-family']",function(){var t=$(this),a=t.parents("div.modal").attr("data-toggle-col"),e=t.val(),o=$("#"+a);o.attr("data-family",e),"default"==e&&o.find("input.form-control").css({"font-family":""}),"custom"==e&&o.find("input.form-control").css({"font-family":"custom"})}),$(".element-image").on("click",function(){var t=l(),e=$("<div class='col-xs-12 el-create-sort' data-layout='12' data-node='image' id='"+t+"'></div>"),o=$("<div class='clearfix'><label class='pull-left'>Select image:</label></div><div class='form-group'><div class='input-group'><span class='input-group-btn'><span class='btn btn-default btn-file row-image'> Browse&mldr;<input name='image' class='imageview_rowimg inputFile' type='file' data-preview='"+t+"'></span></span><input class='form-control file-name' type='text' readonly=''/></div><img class='img-upload' id='img"+t+"' style='max-width: 100%;' src='/img/cpanel/pictureDefault.png'/></div>"),n=i("image-edit-mod");n.appendTo(e),o.appendTo(e),e.appendTo(a),d()}),$(document).on("click","span.image-edit-mod",function(t){t.preventDefault();var a=$(this),e=a.parents("div.el-create-sort"),o=".layout3",n=e.attr("data-layout");"6"==n&&(o=".layout4");var i=e.attr("id");c(o,i)});var c=function(t,a){o.attr("data-toggle-col",a),o.find(t).click(),o.modal("show")};$(document).on("change",".imageview_rowimg",function(){t(this)}),$(document).on("change",".btn-file.row-image :file",function(t){var a=$(this),e=a.val().replace(/\\/g,"/").replace(/.*\//,"");a.trigger("fileSelect",[t,e]);var o=$(this).parents(".input-group").find(".file-name");o.val(e)}),$(document).on("click","span.el-remove",function(t){t.preventDefault(),confirm("Are you sure?")&&$(this).parents(".el-create-sort").remove()}),$(".element-video").on("click",function(){var t=l(),e=$("<div class='col-xs-12 el-create-sort' data-layout='12' data-node='video' id='"+t+"'></div>"),o=$("<div class='clearfix col-xs-12'><label class='pull-left'>Video url:</label></div><div class='col-xs-12'><input name='video' placeholder='video url http://...' class='form-control video-thumb' type='text' data-preview='"+t+"'><img class='video-demo' id='img"+t+"' style='max-width: 100%;' src='/img/cpanel/pictureDefault.png'/></div>"),n=i("video-edit-mod");n.appendTo(e),o.appendTo(e),e.appendTo(a),d()}),$(document).on("change",".video-thumb",function(){var t=$(this).val().match(/youtube\.com.*(\?v=|\/embed\/)(.{11})/).pop();11==t.length&&$(".video-demo").attr("src","//img.youtube.com/vi/"+t+"/0.jpg")}),$(document).on("click","span.video-edit-mod",function(t){t.preventDefault();var a=$(this),e=a.parents("div.el-create-sort"),o="#layout5",n=e.attr("data-layout");"6"==n&&(o="#layout6");var i=e.attr("id");u(o,i)});var u=function(t,a){n.attr("data-toggle-col",a),n.find(t).click(),n.modal("show")};$("#_addElement").bind("click",function(){$("#addNewRow").find(".el-create-sort").length>=2?alert("Remember! You can create only 2 element in one row section..."):$("#addElement").modal("show")}),$("#saveRowJson").bind("click",function(t){t.preventDefault(),$(".loader-ajax").show();var a=[],e=$("#addNewRow").find(".el-create-sort");e.each(function(){var t=$(this);switch(t.attr("data-node")){case"text":var e=[];t.find(".data-rows-count").each(function(){e.push({valueHeader:{en:$(this).find("input[name='eng']").val(),ru:$(this).find("input[name='rus']").val()},valueMain:{en:$(this).find("textarea[name='eng']").val(),ru:$(this).find("textarea[name='rus']").val()}})}),a.push({node:t.attr("data-node"),id:t.attr("id"),layout:t.attr("data-layout"),className:t.attr("class"),asterisk:t.attr("data-asterisk"),styles:{bold:t.attr("data-bold"),textAlign:t.attr("data-alignment"),fontFamily:t.attr("data-family")},elements:e});break;case"image":a.push({node:t.attr("data-node"),className:t.attr("class"),id:t.attr("id"),layout:t.attr("data-layout"),elements:$("img#img"+t.attr("id")).attr("src")});break;case"video":a.push({node:t.attr("data-node"),className:t.attr("class"),id:t.attr("id"),layout:t.attr("data-layout"),elements:$("#"+t.attr("id")).find("input.video-thumb").val()})}}),setTimeout(function(){var t=$("input#prt_id").val().replace(/\"/g,"");$.ajax({type:"POST",url:"/control/admin/portfolio/add/media/"+t,dataType:"json",data:{data:a},success:function(){window.location.href="/control/admin/portfolio/edit?section=media&id="+t},error:function(){window.location.href="/control/admin/portfolio/edit?section=media&id="+t}})},500)}),$("#addElement").modal("show")});